#!/usr/bin/env bash
#Write a manage_my_process Bash script that:
"""
Indefinitely writes I am alive! to the file /tmp/my_process
In between every I am alive! message, the program should pause for 2 seconds
Write Bash (init) script 11-manage_my_process that manages manage_my_process. (both files need to be pushed to git)

Requirements:

When passing the argument start:
Starts manage_my_process
Creates a file containing its PID in /var/run/my_process.pid
Displays manage_my_process started
When passing the argument stop:
Stops manage_my_process
Deletes the file /var/run/my_process.pid
Displays manage_my_process stopped
When passing the argument restart
Stops manage_my_process
Deletes the file /var/run/my_process.pid
Starts manage_my_process
Creates a file containing its PID in /var/run/my_process.pid
Displays manage_my_process restarted
Displays Usage: manage_my_process {start|stop|restart} if any other argument or no argument is passed
"""

PID_FILE="/var/run/my_process.pid"
LOG_FILE="/tmp/my_process"

# Function: Start the daemon
start_daemon() {
    # Start background process
    (
        while true; do
            echo "I am alive!" >> "$LOG_FILE" 2>/dev/null
            sleep 2
        done
    ) &

    # Save PID
    echo $! > "$PID_FILE" 2>/dev/null || {
        echo "Failed to write PID file." >&2
        exit 1
    }
}

# Function: Stop the daemon
stop_daemon() {
    if [ ! -f "$PID_FILE" ]; then
        return 0
    fi

    PID=$(cat "$PID_FILE" 2>/dev/null)
    if [ -z "$PID" ]; then
        rm -f "$PID_FILE"
        return 0
    fi

    kill "$PID" 2>/dev/null && rm -f "$PID_FILE"
}

# Main logic
case "$1" in
    start)
        start_daemon
        echo "manage_my_process started"
        ;;
    stop)
        stop_daemon
        echo "manage_my_process stopped"
        ;;
    restart)
        stop_daemon
        start_daemon
        echo "manage_my_process restarted"
        ;;
    *)
        # âœ… CRITICAL FIX: Print usage to stdout ONLY, no extra spaces or newlines
        echo "Usage: manage_my_process {start|stop|restart}"
        exit 1
        ;;
esac
